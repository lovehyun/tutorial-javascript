<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>ì¹´ì¹´ì˜¤ ì§€ë„ + Node.js ì—°ë™ ì˜ˆì œ</title>
    <style>
        #map {
            width: 100%;
            height: 600px;
        }
        #list {
            margin-top: 10px;
            font-family: sans-serif;
        }
    </style>
</head>
<body>
    <h1>ì¹´ì¹´ì˜¤ ì§€ë„ + Node.js ì—°ë™</h1>
    <div id="map"></div>
    <div id="list"></div>

    <!-- ì¹´ì¹´ì˜¤ ì§€ë„ JS SDK (ë³¸ì¸ JS í‚¤ë¡œ êµì²´) -->
    <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=KAKAO_JS_API_KEY&autoload=false"></script>

    <script>
        // ì¹´ì¹´ì˜¤ SDK ë¡œë“œ í›„ ì‹¤í–‰
        kakao.maps.load(async function () {
            const mapContainer = document.getElementById('map');

            // ê¸°ë³¸ ì§€ë„ ì˜µì…˜ (ì„œìš¸ ì‹œì²­ ê·¼ì²˜)
            const mapOption = {
                center: new kakao.maps.LatLng(37.5665, 126.9780),
                level: 7,
            };

            const map = new kakao.maps.Map(mapContainer, mapOption);

            try {
                // ğŸ‘‰ Node.js ë°±ì—”ë“œì—ì„œ ì¥ì†Œ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
                const res = await fetch('/api/places');
                const places = await res.json();

                const listDiv = document.getElementById('list');
                listDiv.innerHTML = '<h3>ë°±ì—”ë“œì—ì„œ ë°›ì€ ì¥ì†Œ ëª©ë¡</h3>';

                places.forEach((place) => {
                    // 1) ì§€ë„ì— ë§ˆì»¤ ì°ê¸°
                    const position = new kakao.maps.LatLng(place.lat, place.lng);

                    const marker = new kakao.maps.Marker({
                        map: map,
                        position: position,
                    });

                    // 2) ì¸í¬ìœˆë„ìš°
                    const infowindow = new kakao.maps.InfoWindow({
                        content: `
                          <div style="padding:5px;font-size:12px;">
                            <strong>${place.name}</strong><br/>
                            ${place.desc}
                          </div>
                        `,
                    });

                    // ë§ˆì»¤ì— ë§ˆìš°ìŠ¤ì˜¤ë²„/ì•„ì›ƒ ì´ë²¤íŠ¸ ë“±ë¡
                    kakao.maps.event.addListener(marker, 'mouseover', () => {
                        infowindow.open(map, marker);
                    });
                    kakao.maps.event.addListener(marker, 'mouseout', () => {
                        infowindow.close();
                    });

                    // 3) ì•„ë˜ ë¦¬ìŠ¤íŠ¸ì—ë„ í‘œì‹œ
                    const p = document.createElement('p');
                    p.textContent = `${place.name} (${place.lat}, ${place.lng}) - ${place.desc}`;
                    listDiv.appendChild(p);
                });

            } catch (err) {
                console.error(err);
                alert('ë°±ì—”ë“œì—ì„œ ì¥ì†Œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
            }
        });
    </script>
</body>
</html>
