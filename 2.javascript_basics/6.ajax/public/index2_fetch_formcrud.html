<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Localhost CRUD Test</title>
</head>
<body>
    <h1>CRUD Test</h1>

    <!-- 전체 조회 -->
    <section>
        <h2>1. Get All (전체 조회)</h2>
        <button id="btn-get-all">Get All</button>
    </section>

    <!-- 단건 조회 -->
    <section>
        <h2>2. Get One (단건 조회)</h2>
        <label>
            ID:
            <input type="number" id="get-id" placeholder="예: 1" />
        </label>
        <button id="btn-get-one">Get One</button>
    </section>

    <!-- 생성 -->
    <section>
        <h2>3. Create (생성)</h2>
        <form id="form-create">
            <div>
                <label>
                    Title:
                    <input type="text" id="create-title" placeholder="제목 입력" />
                </label>
            </div>
            <div>
                <label>
                    Body:
                    <input type="text" id="create-body" placeholder="내용 입력" />
                </label>
            </div>
            <button type="submit">Create</button>
        </form>
    </section>

    <!-- 수정 -->
    <section>
        <h2>4. Update (수정 - PUT)</h2>
        <form id="form-update">
            <div>
                <label>
                    ID:
                    <input type="number" id="update-id" placeholder="수정할 ID (예: 1)" />
                </label>
            </div>
            <div>
                <label>
                    Title:
                    <input type="text" id="update-title" placeholder="새 제목" />
                </label>
            </div>
            <div>
                <label>
                    Body:
                    <input type="text" id="update-body" placeholder="새 내용" />
                </label>
            </div>
            <button type="submit">Update</button>
        </form>
    </section>

    <!-- 삭제 -->
    <section>
        <h2>5. Delete (삭제)</h2>
        <label>
            ID:
            <input type="number" id="delete-id" placeholder="삭제할 ID (예: 1)" />
        </label>
        <button id="btn-delete">Delete</button>
    </section>

    <hr />

    <!-- 결과 출력 -->
    <h2>Response / Output</h2>
    <pre id="output"></pre>

    <script>
        const BASE_URL = 'http://localhost:3000/posts';

        function printOutput(label, data) {
            const output = document.getElementById('output');
            output.innerText = label + '\n' + JSON.stringify(data, null, 2);
        }

        function printError(err) {
            const output = document.getElementById('output');
            output.innerText = '❌ Error:\n' + err;
            console.error(err);
        }

        // 1. 전체 조회
        async function getAll() {
            try {
                const res = await fetch(BASE_URL);
                if (!res.ok) {
                    throw new Error('GET ALL 실패: ' + res.status);
                }
                const data = await res.json();
                printOutput('✅ GET ALL 성공', data);
            } catch (err) {
                printError(err);
            }
        }

        // 2. 단건 조회
        async function getOne() {
            const id = document.getElementById('get-id').value;
            if (!id) {
                alert('조회할 ID를 입력하세요.');
                return;
            }

            try {
                const res = await fetch(`${BASE_URL}/${id}`);
                if (!res.ok) {
                    throw new Error('GET ONE 실패: ' + res.status);
                }
                const data = await res.json();
                printOutput(`✅ GET ONE 성공 (id=${id})`, data);
            } catch (err) {
                printError(err);
            }
        }

        // 3. 생성
        async function createPost() {
            const title = document.getElementById('create-title').value;
            const body = document.getElementById('create-body').value;

            if (!title || !body) {
                alert('title과 body를 모두 입력하세요.');
                return;
            }

            try {
                const res = await fetch(BASE_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ title, body }),
                });

                if (!res.ok) {
                    throw new Error('CREATE 실패: ' + res.status);
                }

                const data = await res.json();
                printOutput('✅ CREATE 성공', data);

                document.getElementById('create-title').value = '';
                document.getElementById('create-body').value = '';
            } catch (err) {
                printError(err);
            }
        }

        // 4. 수정
        async function updatePost() {
            const id = document.getElementById('update-id').value;
            const title = document.getElementById('update-title').value;
            const body = document.getElementById('update-body').value;

            if (!id) {
                alert('수정할 ID를 입력하세요.');
                return;
            }

            if (!title && !body) {
                alert('수정할 title 또는 body 중 최소 하나는 입력하세요.');
                return;
            }

            const payload = {};
            if (title) payload.title = title;
            if (body) payload.body = body;

            try {
                const res = await fetch(`${BASE_URL}/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload),
                });

                if (!res.ok) {
                    throw new Error('UPDATE 실패: ' + res.status);
                }

                const data = await res.json();
                printOutput(`✅ UPDATE 성공 (id=${id})`, data);
            } catch (err) {
                printError(err);
            }
        }

        // 5. 삭제
        async function deletePost() {
            const id = document.getElementById('delete-id').value;
            if (!id) {
                alert('삭제할 ID를 입력하세요.');
                return;
            }

            if (!confirm(`정말로 id=${id} 데이터를 삭제하시겠습니까?`)) {
                return;
            }

            try {
                const res = await fetch(`${BASE_URL}/${id}`, {
                    method: 'DELETE',
                });

                if (!res.ok) {
                    throw new Error('DELETE 실패: ' + res.status);
                }

                printOutput(`✅ DELETE 성공 (id=${id})`, { deletedId: id });
                document.getElementById('delete-id').value = '';
            } catch (err) {
                printError(err);
            }
        }

        // DOM이 준비된 후에 이벤트 바인딩
        window.addEventListener('DOMContentLoaded', () => {
            document.getElementById('btn-get-all').addEventListener('click', getAll);
            document.getElementById('btn-get-one').addEventListener('click', getOne);
            document.getElementById('form-create').addEventListener('submit', (e) => {
                e.preventDefault();
                createPost();
            });
            document.getElementById('form-update').addEventListener('submit', (e) => {
                e.preventDefault();
                updatePost();
            });
            document.getElementById('btn-delete').addEventListener('click', deletePost);
        });
    </script>
</body>
</html>
