<!DOCTYPE html>
<html>
<body>
    <h1>WebSocket Test (JSON ë²„ì „)</h1>

    <input id="msg" type="text" placeholder="ë©”ì‹œì§€ ì…ë ¥" />
    <button onclick="sendChat()">ì „ì†¡</button>

    <h3>ì±„íŒ… ë¡œê·¸</h3>
    <div id="log"
        style="margin-top:10px; width:400px; height:200px; overflow-y:auto; border:1px solid #ddd; padding:10px;">
    </div>

    <h3>ìƒíƒœ(status) ë¡œê·¸ (Ping / Pong ë“±)</h3>
    <textarea id="statusLog" readonly
        style="margin-top:10px; width:400px; height:150px; padding:10px; border:1px solid #bbb; color:#444; font-size:13px;">
    </textarea>

    <script>
        const socket = new WebSocket("ws://localhost:8080");
        // const socket = new WebSocket("ws://${window.location.hostname}:8080");

        const logBox = document.getElementById("log");
        const statusBox = document.getElementById("statusLog");

        const MESSAGE_TYPES = {
            CHAT: 'chat',
            PING: 'ping',
            PONG: 'pong',
            SYSTEM: 'system',
        };

        // ì¼ë°˜ ë©”ì‹œì§€ ë¡œê·¸
        function addChat(text) {
            const div = document.createElement("div");
            div.textContent = text;
            logBox.appendChild(div);
            logBox.scrollTop = logBox.scrollHeight;
        }

        // ìƒíƒœ ë¡œê·¸ (ì‹œê°„ í¬í•¨)
        function addStatus(text) {
            const now = new Date().toLocaleTimeString();
            statusBox.value += `[${now}] ${text}\n`;
            statusBox.scrollTop = statusBox.scrollHeight;
        }

        socket.onopen = () => {
            addStatus("ì„œë²„ì™€ WebSocket ì—°ê²°ë¨");
        };

        socket.onmessage = (event) => {
            let data;
            try {
                data = JSON.parse(event.data);
            } catch {
                addChat("ì„œë²„(ë¬¸ìì—´): " + event.data);
                return;
            }

            switch (data.type) {
                case MESSAGE_TYPES.SYSTEM:
                    addChat("ğŸ“¢ SYSTEM: " + data.content);
                    break;

                case MESSAGE_TYPES.CHAT:
                    addChat("ğŸ’¬ CHAT: " + data.content);
                    break;

                case MESSAGE_TYPES.PING:
                    addStatus("ğŸ“¡ ì„œë²„ê°€ ping ë³´ëƒ„ â†’ ìë™ pong ì‘ë‹µí•¨");
                    socket.send(JSON.stringify({
                        type: MESSAGE_TYPES.PONG,
                        ts: Date.now()
                    }));
                    break;

                case MESSAGE_TYPES.PONG:
                    addStatus("ğŸ“¡ ì„œë²„ë¡œë¶€í„° PONG ìˆ˜ì‹ ");
                    break;

                default:
                    addStatus("â“ Unknown type: " + data.type);
            }
        };

        function sendChat() {
            const msg = document.getElementById("msg").value;
            if (!msg) return;

            socket.send(JSON.stringify({
                type: MESSAGE_TYPES.CHAT,
                content: msg
            }));

            addChat("ğŸ‘¤ ë‚˜: " + msg);
            document.getElementById("msg").value = "";
        }
    </script>
</body>
</html>
