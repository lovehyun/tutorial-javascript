<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Typing Rush - íƒ€ì´í•‘ ê²Œì„</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            min-height: 100vh;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #141e30, #243b55);
            color: #f5f5f5;
            overflow: hidden;
        }

        /* ë°°ê²½ ì• ë‹ˆë©”ì´ì…˜ìš© íë¦¿í•œ ì› */
        .bg-orb {
            position: fixed;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.35;
            z-index: 0;
        }
        .bg-orb.orb1 {
            width: 400px;
            height: 400px;
            background: #ff6b6b;
            top: -50px;
            left: -80px;
            animation: float1 12s ease-in-out infinite alternate;
        }
        .bg-orb.orb2 {
            width: 500px;
            height: 500px;
            background: #4ecdc4;
            bottom: -120px;
            right: -100px;
            animation: float2 16s ease-in-out infinite alternate;
        }

        @keyframes float1 {
            from { transform: translate(0, 0); }
            to   { transform: translate(80px, 120px); }
        }

        @keyframes float2 {
            from { transform: translate(0, 0); }
            to   { transform: translate(-120px, -80px); }
        }

        /* ê²Œì„ ì¹´ë“œ */
        .game-container {
            position: relative;
            z-index: 1;
            width: min(900px, 95vw);
            background: rgba(15, 20, 35, 0.9);
            border-radius: 24px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.7);
            padding: 24px 28px 28px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 12px;
        }

        .title {
            font-size: 26px;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .subtitle {
            font-size: 13px;
            color: #c0c7d6;
        }

        .badges {
            display: flex;
            gap: 8px;
            font-size: 11px;
        }

        .badge {
            padding: 4px 10px;
            border-radius: 999px;
            background: rgba(255, 255, 255, 0.06);
            border: 1px solid rgba(255, 255, 255, 0.12);
        }

        /* ìƒë‹¨ ì •ë³´ë°” */
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0 14px;
            gap: 16px;
            flex-wrap: wrap;
        }

        .stats-row {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }

        .stat-chip {
            min-width: 120px;
            padding: 8px 10px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            font-size: 13px;
        }

        .stat-label {
            font-size: 11px;
            color: #a8b2c9;
        }

        .stat-value {
            font-size: 18px;
            font-weight: 600;
            margin-top: 2px;
        }

        .timer {
            font-size: 22px;
            font-weight: 700;
            padding: 6px 14px;
            border-radius: 999px;
            background: linear-gradient(135deg, #ff9a9e, #fecfef);
            color: #1b1b1b;
            box-shadow: 0 0 15px rgba(255, 154, 158, 0.4);
        }

        /* ë¬¸ì¥ ì˜ì—­ */
        .phrase-box {
            margin-top: 6px;
            padding: 16px 18px;
            border-radius: 14px;
            background: rgba(7, 11, 25, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.08);
            min-height: 95px;
            font-size: 20px;
            line-height: 1.6;
            letter-spacing: 0.03em;
            overflow-wrap: break-word;
        }

        .phrase-line {
            margin-bottom: 4px;
        }

        .char-done {
            color: #7fd1b9;
        }
        .char-current {
            position: relative;
            color: #ffe66d;
            text-decoration: underline;
            text-decoration-thickness: 2px;
        }
        .char-remaining {
            color: #e0e4f0;
        }

        /* ì•ˆë‚´ í…ìŠ¤íŠ¸ */
        .hint {
            margin-top: 8px;
            font-size: 13px;
            color: #9aa2ba;
        }

        /* ë²„íŠ¼ & ë§ˆì§€ë§‰ í‚¤ */
        .bottom-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 18px;
            gap: 16px;
            flex-wrap: wrap;
        }

        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        button {
            border: none;
            padding: 10px 18px;
            border-radius: 999px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.15s ease;
        }

        #startBtn {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            color: #0b1020;
            box-shadow: 0 0 15px rgba(79, 172, 254, 0.5);
        }
        #startBtn:hover {
            transform: translateY(-1px);
            box-shadow: 0 0 22px rgba(79, 172, 254, 0.75);
        }
        #startBtn:active {
            transform: translateY(0);
            box-shadow: 0 0 10px rgba(79, 172, 254, 0.4);
        }

        #modeBtn {
            background: rgba(255, 255, 255, 0.06);
            color: #e0e4f5;
            border: 1px solid rgba(255, 255, 255, 0.16);
        }
        #modeBtn:hover {
            background: rgba(255, 255, 255, 0.12);
        }

        .last-key-box {
            min-width: 140px;
            text-align: right;
        }

        .last-key-label {
            font-size: 11px;
            color: #a8b2c9;
        }
        .last-key-value {
            font-size: 28px;
            font-weight: 700;
            margin-top: 2px;
        }

        /* ë³´ì´ì§€ ì•ŠëŠ” ì¸í’‹ (ëª¨ë°”ì¼ìš© í¬ì»¤ìŠ¤) */
        #hiddenInput {
            position: absolute;
            opacity: 0;
            pointer-events: none;
            height: 0;
            width: 0;
        }

        /* ì •íƒ€ / ì˜¤íƒ€ íš¨ê³¼ */
        .flash-correct {
            animation: flashCorrect 0.18s ease-out;
        }
        .flash-wrong {
            animation: flashWrong 0.18s ease-out;
        }

        @keyframes flashCorrect {
            from { box-shadow: 0 0 0 rgba(111, 255, 176, 0.0); }
            to   { box-shadow: 0 0 30px rgba(111, 255, 176, 0.6); }
        }

        @keyframes flashWrong {
            from { box-shadow: 0 0 0 rgba(255, 107, 107, 0.0); }
            to   { box-shadow: 0 0 30px rgba(255, 107, 107, 0.6); }
        }

        /* ê²Œì„ ì¢…ë£Œ ë©”ì‹œì§€ */
        .message {
            margin-top: 10px;
            font-size: 14px;
            color: #f0d5ff;
        }

        @media (max-width: 600px) {
            .title {
                font-size: 20px;
            }
            .phrase-box {
                font-size: 17px;
            }
            .timer {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <!-- ë°°ê²½ ì˜¤ë¸Œì íŠ¸ -->
    <div class="bg-orb orb1"></div>
    <div class="bg-orb orb2"></div>

    <div class="game-container" id="gameContainer">
        <div class="game-header">
            <div>
                <div class="title">Typing Rush</div>
                <div class="subtitle">íƒ€ì´í•‘ ì†ë„ì™€ ì •í™•ë„ë¥¼ ë™ì‹œì—! (í‚¤ë³´ë“œë¡œ ë°”ë¡œ ì‹œì‘ ê°€ëŠ¥)</div>
            </div>
            <div class="badges">
                <div class="badge">â± 30ì´ˆ ë¼ìš´ë“œ</div>
                <div class="badge">ğŸ”¥ ì½¤ë³´ ì ìˆ˜</div>
            </div>
        </div>

        <div class="top-bar">
            <div class="stats-row">
                <div class="stat-chip">
                    <div class="stat-label">ì ìˆ˜</div>
                    <div class="stat-value" id="score">0</div>
                </div>
                <div class="stat-chip">
                    <div class="stat-label">WPM (ë¶„ë‹¹ íƒ€ìˆ˜)</div>
                    <div class="stat-value" id="wpm">0</div>
                </div>
                <div class="stat-chip">
                    <div class="stat-label">ì •í™•ë„</div>
                    <div class="stat-value" id="accuracy">0%</div>
                </div>
                <div class="stat-chip">
                    <div class="stat-label">ì½¤ë³´</div>
                    <div class="stat-value" id="combo">x0</div>
                </div>
            </div>
            <div class="timer" id="timer">30.0s</div>
        </div>

        <div class="phrase-box" id="phraseBox">
            <div class="phrase-line" id="phraseLine"></div>
        </div>

        <div class="hint">
            ğŸ”¹ <b>Start</b> ë²„íŠ¼ì„ ëˆ„ë¥¸ í›„, <b>ë°”ë¡œ í‚¤ë³´ë“œë¡œ ë¬¸ì¥ì„ ë”°ë¼ ì¹˜ë©´</b> ë©ë‹ˆë‹¤.  
            ğŸ”¹ Shift, Ctrl ê°™ì€ íŠ¹ìˆ˜í‚¤ëŠ” ë¬´ì‹œë˜ê³ , ì‹¤ì œ ë¬¸ì í‚¤ë§Œ ì¸ì‹í•©ë‹ˆë‹¤.
        </div>

        <div class="bottom-row">
            <div class="controls">
                <button id="startBtn">Start</button>
                <button id="modeBtn">ë¬¸ì¥ ëª¨ë“œ</button>
            </div>
            <div class="last-key-box">
                <div class="last-key-label">ë§ˆì§€ë§‰ í‚¤</div>
                <div class="last-key-value" id="lastKey">-</div>
            </div>
        </div>

        <div class="message" id="message"></div>

        <!-- ëª¨ë°”ì¼ í¬ì»¤ìŠ¤ìš© ìˆ¨ê¹€ ì¸í’‹ -->
        <input type="text" id="hiddenInput" autocomplete="off">
    </div>

    <script>
        // ====== ìƒìˆ˜ ë° ìƒíƒœ ======
        const PHRASES = [
            "stay hungry stay foolish",
            "talk is cheap show me the code",
            "first solve the problem then write the code",
            "simplicity is the soul of efficiency",
            "programming is the art of algorithm design",
            "practice makes progress not perfection",
            "typing games can actually be fun",
            "keyboard mastery starts with small steps"
        ];

        const GAME_DURATION = 30_000; // 30ì´ˆ (ms ë‹¨ìœ„)

        let isRunning = false;
        let startTime = null;
        let timerId = null;

        let currentPhraseIndex = 0;
        let currentCharIndex = 0;

        let totalTyped = 0;   // ì „ì²´ ì…ë ¥ íšŸìˆ˜
        let correctTyped = 0; // ì •íƒ€ ìˆ˜
        let score = 0;
        let combo = 0;
        let bestCombo = 0;

        // ====== DOM ìš”ì†Œ ======
        const gameContainer = document.getElementById("gameContainer");
        const phraseBox = document.getElementById("phraseBox");
        const phraseLine = document.getElementById("phraseLine");
        const scoreEl = document.getElementById("score");
        const wpmEl = document.getElementById("wpm");
        const accuracyEl = document.getElementById("accuracy");
        const comboEl = document.getElementById("combo");
        const timerEl = document.getElementById("timer");
        const lastKeyEl = document.getElementById("lastKey");
        const messageEl = document.getElementById("message");
        const startBtn = document.getElementById("startBtn");
        const modeBtn = document.getElementById("modeBtn");
        const hiddenInput = document.getElementById("hiddenInput");

        // í˜„ì¬ ë¬¸ì¥ ê°€ì ¸ì˜¤ê¸°
        function getCurrentPhrase() {
            return PHRASES[currentPhraseIndex];
        }

        // ë¬¸ì¥ ë Œë”ë§
        function renderPhrase() {
            const phrase = getCurrentPhrase();
            const done = phrase.slice(0, currentCharIndex);
            const current = phrase[currentCharIndex] ?? "";
            const remaining = phrase.slice(currentCharIndex + 1);

            // HTMLë¡œ ì¡°í•©
            let html = "";
            html += `<span class="char-done">${escapeHtml(done)}</span>`;
            if (current) {
                html += `<span class="char-current">${escapeHtml(current)}</span>`;
            }
            html += `<span class="char-remaining">${escapeHtml(remaining)}</span>`;

            phraseLine.innerHTML = html;
        }

        // HTML ì´ìŠ¤ì¼€ì´í”„
        function escapeHtml(str) {
            return str
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;");
        }

        // ê²Œì„ ìƒíƒœ ì´ˆê¸°í™”
        function resetGameState() {
            isRunning = false;
            startTime = null;
            if (timerId) {
                clearInterval(timerId);
                timerId = null;
            }

            currentPhraseIndex = 0;
            currentCharIndex = 0;

            totalTyped = 0;
            correctTyped = 0;
            score = 0;
            combo = 0;
            bestCombo = 0;

            scoreEl.textContent = "0";
            wpmEl.textContent = "0";
            accuracyEl.textContent = "0%";
            comboEl.textContent = "x0";
            timerEl.textContent = (GAME_DURATION / 1000).toFixed(1) + "s";
            lastKeyEl.textContent = "-";
            messageEl.textContent = "";
        }

        // WPM, ì •í™•ë„ ê°±ì‹ 
        function updateStats() {
            const now = Date.now();
            const elapsedMs = now - startTime;
            const elapsedMinutes = elapsedMs / 1000 / 60;

            let wpm = 0;
            if (elapsedMinutes > 0) {
                wpm = (correctTyped / 5) / elapsedMinutes; // 5ê¸€ìë¥¼ 1ë‹¨ì–´ë¡œ ê°€ì •
            }

            const accuracy = totalTyped > 0
                ? (correctTyped / totalTyped) * 100
                : 0;

            wpmEl.textContent = Math.round(wpm);
            accuracyEl.textContent = Math.round(accuracy) + "%";
            comboEl.textContent = "x" + combo;
            scoreEl.textContent = score;
        }

        // íƒ€ì´ë¨¸ ì‹œì‘
        function startTimer() {
            startTime = Date.now();
            const endTime = startTime + GAME_DURATION;

            timerId = setInterval(() => {
                const now = Date.now();
                const remainingMs = endTime - now;

                if (remainingMs <= 0) {
                    timerEl.textContent = "0.0s";
                    endGame();
                    return;
                }

                const seconds = remainingMs / 1000;
                timerEl.textContent = seconds.toFixed(1) + "s";
            }, 80);
        }

        // ê²Œì„ ì‹œì‘
        function startGame() {
            resetGameState();
            isRunning = true;

            renderPhrase();
            startTimer();

            startBtn.textContent = "Restart";
            messageEl.textContent = "ê²Œì„ì´ ì‹œì‘ëìŠµë‹ˆë‹¤! ë¬¸ì¥ì„ ê·¸ëŒ€ë¡œ ë”°ë¼ ì³ë³´ì„¸ìš”.";

            // PCì—ì„œëŠ” êµ³ì´ í•„ìš” ì—†ì§€ë§Œ, ëª¨ë°”ì¼ ëŒ€ë¹„ ìˆ¨ê¹€ ì¸í’‹ì— í¬ì»¤ìŠ¤
            hiddenInput.focus();
        }

        // ê²Œì„ ì¢…ë£Œ
        function endGame() {
            isRunning = false;
            if (timerId) {
                clearInterval(timerId);
                timerId = null;
            }

            updateStats();

            messageEl.textContent =
                `ê²Œì„ ì¢…ë£Œ! ìµœì¢… ì ìˆ˜ ${score}ì , ìµœê³  ì½¤ë³´ x${bestCombo} ì…ë‹ˆë‹¤. Startë¥¼ ëˆŒëŸ¬ ë‹¤ì‹œ ë„ì „í•´ ë³´ì„¸ìš”.`;
        }

        // ì •íƒ€ ì—°ì¶œ
        function flashCorrect() {
            gameContainer.classList.remove("flash-correct");
            void gameContainer.offsetWidth; // reflow íŠ¸ë¦­
            gameContainer.classList.add("flash-correct");
        }

        // ì˜¤íƒ€ ì—°ì¶œ
        function flashWrong() {
            gameContainer.classList.remove("flash-wrong");
            void gameContainer.offsetWidth;
            gameContainer.classList.add("flash-wrong");
        }

        // ë‹¤ìŒ ë¬¸ì¥ìœ¼ë¡œ ë„˜ì–´ê°€ê¸°
        function nextPhrase() {
            currentPhraseIndex = (currentPhraseIndex + 1) % PHRASES.length;
            currentCharIndex = 0;
            renderPhrase();
        }

        // ====== ì´ë²¤íŠ¸ ======
        startBtn.addEventListener("click", () => {
            startGame();
        });

        // ëª¨ë“œ ë²„íŠ¼ì€ í™•ì¥ìš© (ì§€ê¸ˆì€ ë¬¸ì¥ ëª¨ë“œ ê³ ì •)
        modeBtn.addEventListener("click", () => {
            alert("ì§€ê¸ˆì€ 'ë¬¸ì¥ ëª¨ë“œ'ë§Œ ìˆìŠµë‹ˆë‹¤. ë‚˜ì¤‘ì— 'ëœë¤ ê¸€ì í­ì£¼ ëª¨ë“œ'ë„ ì¶”ê°€í•´ë³¼ê¹Œìš”? ğŸ˜„");
        });

        // ì „ì²´ ë¬¸ì„œ í‚¤ë‹¤ìš´ ì´ë²¤íŠ¸
        document.addEventListener("keydown", (event) => {
            // F5, Ctrl+R ê°™ì€ ê²ƒì€ ë¬´ì‹œ
            if (event.key === "F5" || (event.ctrlKey && event.key.toLowerCase() === "r")) {
                return;
            }

            // ê²Œì„ ì¤‘ì´ ì•„ë‹ˆë©´: Start ë²„íŠ¼ íŒíŠ¸
            if (!isRunning) {
                return;
            }

            const key = event.key;

            // ì‹¤ì œ ë¬¸ì í‚¤ë§Œ ì²˜ë¦¬ (ê¸¸ì´ 1ì´ ì•„ë‹Œ í‚¤ëŠ” ë¬´ì‹œ)
            if (key.length !== 1) {
                return;
            }

            lastKeyEl.textContent = key;

            const phrase = getCurrentPhrase();
            const expectedChar = phrase[currentCharIndex];

            // í†µê³„ìš© ì „ì²´ ì…ë ¥ ìˆ˜ ì¦ê°€
            totalTyped++;

            // ë¹„êµ (ëŒ€ì†Œë¬¸ì êµ¬ë¶„ ì—†ì´ í•˜ê³  ì‹¶ë‹¤ë©´ ë‘˜ ë‹¤ toLowerCase() ì‚¬ìš©)
            if (key === expectedChar) {
                // ì •íƒ€
                correctTyped++;
                combo++;
                if (combo > bestCombo) bestCombo = combo;

                // ì ìˆ˜: ê¸°ë³¸ 10ì  + ì½¤ë³´ ë³´ë„ˆìŠ¤
                score += 10 + combo;

                currentCharIndex++;
                flashCorrect();

                // ë¬¸ì¥ ëê¹Œì§€ ì³¤ë‹¤ë©´ ë‹¤ìŒ ë¬¸ì¥ìœ¼ë¡œ
                if (currentCharIndex >= phrase.length) {
                    score += 100; // ë¬¸ì¥ ì™„ë£Œ ë³´ë„ˆìŠ¤
                    nextPhrase();
                } else {
                    renderPhrase();
                }
            } else {
                // ì˜¤íƒ€
                combo = 0;
                score = Math.max(0, score - 5); // í˜ë„í‹°
                flashWrong();
            }

            updateStats();
        });

        // ì´ˆê¸° í™”ë©´ ì„¸íŒ…
        renderPhrase();
    </script>
</body>
</html>
