<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>μΌμ •κ΄€λ¦¬ μΊλ¦°λ”</title>
</head>
<body>
    <h1>π“… μΌμ •κ΄€λ¦¬ μΊλ¦°λ”</h1>
    <input type="date" id="datePicker" />
    <input type="text" id="titleInput" placeholder="μΌμ • μ λ©" />
    <textarea id="descInput" placeholder="μ„¤λ… (μ„ νƒ)"></textarea>
    <button onclick="addEvent()">μΌμ • μ¶”κ°€</button>
    <h3>ν•΄λ‹Ή λ‚ μ§μ μΌμ •</h3>
    <ul id="eventList"></ul>

    <script>
        const dateInput = document.getElementById('datePicker');
        const titleInput = document.getElementById('titleInput');
        const descInput = document.getElementById('descInput');
        const eventList = document.getElementById('eventList');

        dateInput.addEventListener('change', fetchEvents);

        function fetchEvents() {
            const date = dateInput.value;
            fetch(`/events/${date}`)
                .then(res => res.json())
                .then(events => {
                    eventList.innerHTML = '';
                    events.forEach(ev => {
                        const li = document.createElement('li');
                        li.textContent = `${ev.title} - ${ev.description || ''}`;
                        const delBtn = document.createElement('button');
                        delBtn.textContent = 'μ‚­μ ';
                        delBtn.onclick = () => deleteEvent(ev.id);
                        li.appendChild(delBtn);
                        eventList.appendChild(li);
                    });
                });
        }

        function addEvent() {
            const date = dateInput.value;
            const title = titleInput.value;
            const desc = descInput.value;

            if (!date || !title) return alert('λ‚ μ§μ™€ μ λ©μ€ ν•„μμ…λ‹λ‹¤.');

            fetch('/events', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ date, title, description: desc })
            })
            .then(res => res.json())
            .then(() => {
                titleInput.value = '';
                descInput.value = '';
                fetchEvents();
            });
        }

        function deleteEvent(id) {
            fetch(`/events/${id}`, { method: 'DELETE' })
                .then(res => res.json())
                .then(() => fetchEvents());
        }
    </script>
</body>
</html>
